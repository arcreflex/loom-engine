# Glossary

Canonical vocabulary for humans and agents collaborating on the loom-engine system.

## Core Entities

### Root
A top-level container for a conversation tree. RootData is a special node with no message; it has config.systemPrompt and child_ids. In serialization, root is rendered as role=system with message equal to the systemPrompt. Each Root has a unique RootId and is listed in the `roots.json` index file.

### Node
An individual point in a conversation tree that contains exactly one Message. Forest represents each role turn as a node; the path from root to a node is the conversation history. Each Node has a unique NodeId (scoped within its Root) and maintains parent/child relationships that form the tree structure.

### Message
Individual communication units within a Node. Three types exist:
- **User messages**: Human input with text content
- **Assistant messages**: AI model responses, may include tool calls
- **Tool messages**: Results from tool execution, correlated by tool_call_id

### Forest
The core tree management class that provides operations for creating, navigating, and modifying conversation trees. Handles getOrCreateRoot, path traversal, append operations, and tree editing.

## Tool System

### Tool
A function that can be called by AI models during generation. Tools take JSON parameters and return string results. Tools can be built-in (like `current_date`) or provided by MCP servers.

### Tool Call
A request from an AI model to execute a specific tool with given parameters. Tool calls are generated by assistant messages and have unique IDs for correlation with tool results.

### Tool Result
The output from executing a tool call. Tool results are stored as tool messages in the conversation and reference the original tool call by ID.

## Technical Components

### Provider
An adapter class that interfaces with specific AI services (OpenAI, Anthropic, Google). Providers normalize message formats, handle tool calling, and translate between internal and service-specific formats.

### Model
A specific AI model offered by a provider (e.g., "gpt-4o", "claude-3-sonnet"). Models are referenced using the format "{provider}/{model-name}" and have associated capabilities like context length and tool support.

### Preset
A named collection of generation parameters (temperature, max_tokens, system prompt) that can be selected to override default settings. Presets enable quick switching between different generation modes.

### Bookmark
A saved reference to a specific Node in a conversation, allowing quick navigation. Bookmarks are validated before use and automatically updated or removed when referenced nodes are deleted.

## Navigation and Structure

### Path
A sequence of nodes (messages) from a Root to a target Node, representing the complete conversation history. Paths are deterministic and used for message history construction during generation.

### Prefix Matching
The algorithm used when appending new content to existing conversations. Finds the longest common prefix between new and existing message sequences, enabling efficient tree reuse and branching.

### Split
An editing operation that divides a Node's content at a specific point, creating a new Node for the content after the split point. Used for fine-grained conversation editing.

## Communication and Streaming

### SSE (Server-Sent Events)
The streaming protocol used to provide real-time updates from the server to the GUI during generation. Enables live display of generation progress and partial responses.

### Topology
A content-free view of the conversation tree structure, showing only parent/child relationships without message content. Used for navigation and caching efficiency through the NodeStructure cache.

## System Architecture

### LoomEngine
The main orchestration class that coordinates providers, parameters, and generation flows. Handles provider selection, tool execution, and the complete generation lifecycle including tool-calling recursion.

### Store
The persistence abstraction layer, with FileSystemStore as the default implementation. Handles reading and writing conversation data, caching, and maintaining data consistency.

### SerialQueue
The concurrency control mechanism that ensures deterministic ordering of tree-modifying operations. Prevents race conditions and maintains data integrity during concurrent access.

### NodeStructure
A lightweight representation of tree topology that excludes message content. Used for efficient navigation and caching without loading full conversation data.

## Configuration and Setup

### Data Directory
The filesystem location where all conversation data and configuration is stored. Defaults to `~/.loom/` but can be overridden with the `DATA_DIR` environment variable.

### MCP (Model Context Protocol)
A protocol for integrating external tools and capabilities. MCP servers provide tools that are discovered and integrated into the tool registry with namespace prefixes.

### Generation Parameters
Settings that control AI model behavior including temperature, max_tokens, model selection, and tool availability. Can be set via defaults, presets, or per-request.

## Operations and Workflows

### Append
Adding new messages to a conversation tree. Uses prefix matching to find the optimal insertion point and may reuse existing nodes for identical content sequences.

### Generate
The process of requesting AI model responses, including message history construction, provider interaction, tool execution, and result integration back into the conversation tree.

### Edit
Modifying existing conversation content using the Longest Common Prefix (LCP) algorithm to create branches at divergence points while preserving conversation history.

### Delete
Removing nodes from the conversation tree with two strategies: cascade (remove node and all descendants) or reparent (attach children to the deleted node's parent).

## State and Consistency

### Cache Invalidation
The process of clearing outdated NodeStructure cache entries when tree modifications occur. Ensures navigation reflects current tree state.

### Atomic Operations
Operations that complete entirely or not at all, preventing partial modifications that could corrupt the conversation tree structure.

### Deterministic Behavior
The guarantee that the same sequence of operations will always produce the same tree state, achieved through serialized execution and consistent algorithms.